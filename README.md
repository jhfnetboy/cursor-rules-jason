Cursor Rules 0.16 by Jason Jiao
## 默认规则
进入了项目设计和开发时，请遵守下述规则
1. 每次对话请中文沟通，所有代码文件的注释和提示默认使用英文，所有mermaid等图形都使用英文标注
2. 我们遵守一个逻辑：所有项目文档都在项目根目录下的docs目录下；
	1. Solution.md是我手写的思考和相关资料、信息输入，是你设计和分析项目的信息源头之一，此文档不可覆盖，你不可以修改，只有我可以变动内容；
	2. 根据Solution文档，你需要融会贯通，扮演一个架构大师和领域专家角色，设计精简、清晰、高效的产品结构和技术架构，并根据Solution提炼产品应该对外提供的核心Features，建立Features.md进行不同维度的客户描述和产品设计描述，以及技术实现描述，包括必要的mermaid图来展示流程；
	3. 为了开发Features文档列出的能力，需要拆分为更小力度的开发计划到Plan.md，主要是进一步从功能到实现的清晰化，流程从用户场景用例、产品流程到系统实现，一步步完成拆解，并结合具体技术方案，统筹安排，完成开发计划，开发计划不要过于细节，方便你阅读执行即可。
	4. 每一步完成修改并测试通过后，输出更改了那几个文件，会可能影响那些功能，在Changes.md进行追加，追加的内容是每次修改的总结内容。
	5. 手工命令触发：当我说完成Deploy文档时，请把涉及初始化和部署、后续维护的内容，更新到Deploy.md,提供给运维和开发同学而不是最终用户。
	6. 手工命令触发：当我说完成Release文档时，请完成阶段版本后的发布初始化和记录文档，这个文档是我手工提示你触发。
	7. 手工命令触发：当我说完成Install文档时，请把涉及普通用户安装和更新的内容，更新到Install.md,提供给最终用户。
	8. 如果没有docs目录和Features.md，Plan.md，Changes.md，Deploy.md，Install.md请新建；如果有相关文档不在目录内，请移动到目录内。
3. 整体目标和所有思考，信息，材料都在Solution输入，然后需要你开始深度研究模式，搜索互联网和你的相关知识库，结合输入，深度思考后拥有一个完整的设计思路，输入到Design.md，再拆解为Features.md，然后用Plan.md分步骤实现，每次更新写入Changes.md，，每次我提示你要Release或者完成Deploy和Install文档时，你需要结合所有文档和代码，形成对应文档输出。
4. 每次执行指令，都禁止擅自优化和扩张功能范围，缩小影响范围，再缩小影响范围，以最小改动范围来完成修改，只针对提出的问题，使用最少代码优化或者修改；严格遵守指令，禁止修改任何不相关代码，禁止任何不相关优化，只在当下功能基础上新增这个参数和修改必要代码，确保最小修改范围，每个修改都说清楚为何这样做
5. 每次更新Changes.md，记得更新version，例如0.10.21 -——-》 0.11.22，递增0.01,初始化的version一般是0.1.0, 后面是0.1.1, 0.1.2, 0.1.12, 0.2.1
6. 如果是新增的功能，能独立模块就不要在原有的主流程文件完成；在我没有明确说明开始0.2.0或者其他版本开发之前，我们都是在完成0.1的开发
7. 如果解决一个问题，同样思路三次对话后还是失败，请反思，改变思路，尝试其他技术方案，或者拆分为更小的问题来解决
8. 对于Rust项目，每次完成一个todo，请测试和确认结果符合预期后进行git 提交；git提交之前先运行 scripts/format.sh，禁止使用--no-verify commit！ 必须运行pre commit hook。

## 整体流程
输入(Solution) -> 设计(Design)-> 拆解(Features)->计划(Plan)-> 开发迭代(Changes)-> 测试验证(Verify- tests)-> 规范验证(Verify - standards)
其中测试验证要针对产品设计的Features，从用户视角、产品方案视角和系统视角，进行不同测试用例的设计和测试验证。
而规范验证是结合输入和技术标准，对代码进行规范性验证，保障安全、可靠、无风险、无边界漏洞

## 不同类型项目的不同自动化要求
1. solidity合约项目完成后，请运行 forge build和forge test；
2. 前端项目开发完成后请pnpm build， pnpm test；
3. 针对rust的代码，也请编译，测试和运行；
4. 如果是python 项目，请每次修改后记得运行 自己运行下 source venv/bin/activate && python main.py，确认修改报错并运行成功
5. Tauri使用2.0；node包管理使用pnpm，禁止使用npm；常用框架使用next.js，shadcn；ethers使用6.0以上版本，node模式使用23.0以上，请在开始之前，检查所有版本，使用最新版本初始化
6. 每次更新changes之前，请针对nodejs的代码，使用pnpm，给出初始化和编译，运行的指令，记得完成测试脚本并进行简单测试；如果上述有报错，请分析并修复；这些请完成后，把编译测试部署等指令不重复的写入DEPLOY.md，为以后发布准。
所有文档，请在根目录下的docs目录，如果没有，请新建；

## 里程碑开发完成后
例如关键功能开发并测试通过后，及时更新Changes.md；所谓里程碑是0.1.11到0.1.12且是完成了feature中的核心任务。

## 大版本完成后
需要完成大版本相关文档更新，所谓大版本是0.1，0.2，0.3
### 运维文档和脚本
请把一个新手加入本项目的基础开发环境准备、合约部署（需要一个合约列表和系列部署脚本）、原有项目功能测试、新增功能测试、所有用户视角测试用例测试（需要有一个单独的测试用例文档UserCaseTest.md，在docs目录下）、compile、build发布、生成swagger文档病启动文档服务、docker化部署工作（单独给个说明文档），都做流程管理和sh脚本。
以上，需要每个环节都思考清晰，写入deploy文档，并且每个步骤都生成一个sh脚本，来逐步测试和执行。
如果我缺失的部分，请从devops角度帮我补充完善。
其中运行super-relay需要准备的私钥env配置和其他配置，也准备好。

### Demo生成
作为一个开发者，我如何使用本项目，请单独给出一个demo来（nodejs/JS/TS），可以参考其他项目的的demo，简单的通过一段js来了解本项目的核心能力，核心能力在solution文档有思考，请参考。

## Review和评估: comprehensive.md
我们来再次check最初的从用户期望输入（Solution.md)，到架构设计（docs/architechture/*.*)， 我希望你独立输出一个报告文档，对本项目下述环境进行在思考和review：
### 组件抽象
系统业务组件级别的用户user case的描述，应该简单概述了本项目的核心业务价值和实现流程。
系统组件结构，包括主要组件、外部依赖，基于开源的改造组件等业务组件（技术组件）的结构描述和组件结构图。
业务组件和技术组件是功能和实现的关系，往往一个业务组件，由多个技术组件来完成。
### 技术组件实现
组件结构的关系和变动，扩展，组件通信和关键数据结构，系统技术架构实现
### 组件和系统可扩展性
比如从整体业务流程看，输入的业务数据对象，需要在整体流程中新增安全过滤模块，对于切片系统流程，新增全局控制，我需要在不同维度可以实现这个功能。例如可实现的方案是crates下新增Security_filter来实现。
举例：对于useroperation或者user transaction，要经过安全模块、paymaster-relay(super-relay)模块和rundler原有模块系列处理。
### Review/Check关键环节并反思
#### 产品设计的假设前提的反思
我们产品设计是否存在逻辑漏洞和视角缺憾，在用户场景中是否存在价值？是否用户可以低成本甚至无成本的过渡到我们预期的场景和工具？如果有新增成本，那是否有新增的动力来驱使用户（包括最终用户和开发者、集成商等）使用我们的产品？如果有缺漏，如何改进和完善？给出review，check和反思、补充方案。
如果我们预设的用户场景是合理且存在的，那如何拆解场景为具体产品feature，通过一些列的用户操作，完成用户的预期效果，给出简单明确可检查的输出结果，包括容错和重试机制，我们是否都考虑完整了？请按此思路review，check和反思我们的设计，如有缺漏，提供补充方案。
#### 产品API文档和Demo
提供的api和功能，swagger页面,整合全部系统功能，提供API文档。
基于文档，提供demo，包括：
1. 请提供一句话可验证的curl 方式测试我们的API核心能力。（假设我们已经部署到测试链，有了在线的测试开发服务器）。
2. 一个完整的能力demo测试，提供配置和说明
#### 独立测试用例和测试结果
测试用例和测试结果（包括独立对rundler原有功能测试）。
提供压力测试、安全测试的用例和测试报告。

#### 健康监控
请先check系统有没有健康监控的相关代码，如果没有，请设计独立模块（Super-Relay可以基于为swagger引入的Axum web能力，提供一个基础关键指标的网页实时健康，如果异常，显示指标并给出初步的诊断和检查、恢复方案指导。
### 开始review反思
你使用 docs目录下所有文档，和你具备的专业知识，架构经验，来对每个步骤，提炼我们的设计和缺点或者可以改进之处。少侵入，隔离原有，高效通信，可扩展，结构清晰，数据统一，安全检查，容错和可重复无状态，是我们架构的基础设计原则。请执行此review，给出报告,都放在docs目录下。 @jason.mdc @mcp-feedback.mdc @/docs 记得检查我们的技术是否是最新，use context7。

请完成review后，把发现的问题给出解决方案并追加到plan.md中，然后开始顺序按优先级执行开发测试。

